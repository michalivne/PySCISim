CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

PROJECT(PYSCISIM)

FIND_PACKAGE(SWIG REQUIRED)
INCLUDE(${SWIG_USE_FILE})

FIND_PACKAGE(PythonLibs REQUIRED)
INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_PATH})

FIND_PACKAGE(Numpy REQUIRED)
INCLUDE_DIRECTORIES(${NUMPY_INCLUDE_DIR})

# Eigen3 is required
FIND_PACKAGE( Eigen3 3.1 REQUIRED )
INCLUDE_DIRECTORIES( ${EIGEN3_INCLUDE_DIR} )

# RapidXML is required
#FIND_PACKAGE( RapidXML REQUIRED )
#INCLUDE_DIRECTORIES( ${RAPIDXML_INCLUDE_DIR} )

FIND_PACKAGE( Ipopt REQUIRED )
INCLUDE_DIRECTORIES( ${IPOPT_INC_DIRS} )

# OpenGL is required
find_package( OpenGL REQUIRED )
include_directories( ${OPENGL_INCLUDE_DIR} )

# Qt4 is required
find_package( Qt4 COMPONENTS QtCore QtGui QtOpenGL REQUIRED )
include( ${QT_USE_FILE} )

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})

SET(PYSCISIM_FILES PySCISim.cpp PySCISim.h
        ${SCISim_INCLUDE_DIR}/ThreeDRigidBodiesCLI/threed_rigid_bodies_cli.cpp 
    )

SET(PYSCISIM_LIBRARIES 
    SDIC
    ThreeDRigidBodies
    ThreeDRigidBodiesUtils
    ${CMAKE_THREAD_LIBS_INIT}
    ${IPOPT_LIB}
    ${QT_LIBRARIES} 
    ${OPENGL_LIBRARIES}
)

# PySCISim library
ADD_LIBRARY(PySCISim_obj OBJECT ${PYSCISIM_FILES})
ADD_LIBRARY(PySCISim $<TARGET_OBJECTS:PySCISim_obj>)
TARGET_LINK_LIBRARIES(PySCISim ${PYSCISIM_LIBRARIES})

# PySCISim SWIG library
IF( CMAKE_GENERATOR STREQUAL "Xcode" )
    MESSAGE(WARNING "Skipping Python SWIG bindings in Xcode generator mode.")
ELSE ()
    SET_SOURCE_FILES_PROPERTIES(PySCISim.i PROPERTIES CPLUSPLUS ON)
    SWIG_ADD_MODULE(PySCISim python PySCISim.i  $<TARGET_OBJECTS:PySCISim_obj>)
    SWIG_LINK_LIBRARIES(PySCISim 
        ${PYSCISIM_LIBRARIES}
        ${PYTHON_LIBRARIES}
    )
ENDIF()
        
